# =============================================================================
# Orion Sentinel HA DNS - Production Environment Configuration
# =============================================================================
#
# This is the simplified, production-ready configuration file.
# Copy this to .env and customize for your environment.
#
# Quick Start Guide:
#   1. Copy this file: cp .env.production.example .env
#   2. Set REQUIRED variables (marked with REQUIRED)
#   3. Adjust NETWORK settings for your LAN
#   4. Generate secure passwords: openssl rand -base64 32
#   5. Run: make validate-env
#   6. Deploy: make up-core
#
# For Two-Pi HA Setup:
#   - Copy .env to both Pis
#   - On Pi1: Use env/pi1.env.example values
#   - On Pi2: Use env/pi2.env.example values
#
# =============================================================================

# =============================================================================
# DEPLOYMENT MODE
# =============================================================================
# Options: single-pi-ha, two-pi-ha
# - single-pi-ha: All services on one Pi (container-level redundancy)
# - two-pi-ha: Services split across two Pis (hardware-level redundancy)
DEPLOYMENT_MODE=two-pi-ha

# =============================================================================
# NETWORK CONFIGURATION (REQUIRED)
# =============================================================================
# Adjust these for your home network

# HOST_IP: IP address of THIS Pi
# For two-pi-ha: Set differently on each Pi (see env/pi1.env.example, env/pi2.env.example)
HOST_IP=192.168.8.250

# Network interface name (usually eth0 for wired, wlan0 for WiFi)
NETWORK_INTERFACE=eth0

# Your network subnet and gateway
SUBNET=192.168.8.0/24
GATEWAY=192.168.8.1

# Timezone (use your local timezone)
TZ=Europe/London

# =============================================================================
# VIRTUAL IP (VIP) CONFIGURATION (REQUIRED for HA)
# =============================================================================
# The VIP is the DNS server address that clients will use
# It automatically floats between Pi1 and Pi2 for high availability

# VIP_ADDRESS: Must be in your subnet, not .0 or .255, and not used by any device
VIP_ADDRESS=192.168.8.249

# =============================================================================
# KEEPALIVED CONFIGURATION (REQUIRED for two-pi-ha)
# =============================================================================
# Controls VIP failover between nodes

# NODE_ROLE: MASTER or BACKUP
# For two-pi-ha: Set MASTER on Pi1, BACKUP on Pi2
NODE_ROLE=MASTER

# KEEPALIVED_PRIORITY: Higher number = preferred MASTER
# For two-pi-ha: Pi1=200, Pi2=150
KEEPALIVED_PRIORITY=200

# PEER_IP: IP of the other Pi (only needed for two-pi-ha with unicast)
# For Pi1: Set to Pi2's IP
# For Pi2: Set to Pi1's IP
PEER_IP=192.168.8.251

# Virtual Router ID (must be same on both Pis, unique on your network: 1-255)
VIRTUAL_ROUTER_ID=51

# Use unicast instead of multicast (recommended for most networks)
USE_UNICAST_VRRP=true

# VRRP Password - MUST be same on both Pis (REQUIRED)
# Generate with: openssl rand -base64 20
VRRP_PASSWORD=CHANGE_ME_REQUIRED

# =============================================================================
# PI-HOLE CONFIGURATION (REQUIRED)
# =============================================================================

# Pi-hole admin password (REQUIRED)
# Generate with: openssl rand -base64 32
PIHOLE_PASSWORD=CHANGE_ME_REQUIRED

# Pi-hole upstream DNS - Points to local Unbound for privacy
# DO NOT CHANGE unless you understand the privacy implications
PIHOLE_DNS1=127.0.0.1#5335
PIHOLE_DNS2=127.0.0.1#5335

# Pi-hole blocklist profile
# Options: standard (default), family (child-safe), paranoid (max privacy)
PIHOLE_BLOCKLIST_PROFILE=standard

# Pi-hole web theme
PIHOLE_THEME=default-dark

# =============================================================================
# UNBOUND CONFIGURATION
# =============================================================================

# Enable smart DNS prefetching for better performance
# 0 = disabled (default), 1 = enabled
UNBOUND_SMART_PREFETCH=0

# =============================================================================
# MONITORING & OBSERVABILITY (OPTIONAL)
# =============================================================================

# Enable monitoring exporters
# Set to 'true' to deploy node_exporter, pihole_exporter, unbound_exporter
DEPLOY_MONITORING=false

# Grafana credentials (only needed if deploying Grafana)
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=CHANGE_ME_OPTIONAL

# Prometheus retention period
PROMETHEUS_RETENTION=30d

# =============================================================================
# NOTIFICATIONS (OPTIONAL)
# =============================================================================

# Enable email or webhook notifications for failover events
NOTIFY_ON_FAILOVER=false
NOTIFY_ON_FAILBACK=false

# Webhook URL for alerts (optional)
ALERT_WEBHOOK=

# Signal notifications (optional - requires signal-cli setup)
SIGNAL_NUMBER=
SIGNAL_RECIPIENTS=

# =============================================================================
# BACKUP & SYNC (OPTIONAL)
# =============================================================================

# Automatic backup interval in seconds (default: daily)
BACKUP_INTERVAL=86400

# Backup retention in days
RETENTION_DAYS=30

# Pi-hole sync interval in seconds (for two-pi-ha)
SYNC_INTERVAL=300

# =============================================================================
# ADVANCED SETTINGS (Optional - defaults are sensible)
# =============================================================================

# Health check configuration
DNS_CHECK_TIMEOUT=2
DNS_CHECK_RETRIES=3
TEST_DOMAIN=google.com

# Resource limits
PIHOLE_CPU_LIMIT=1.0
PIHOLE_MEM_LIMIT=512M
UNBOUND_CPU_LIMIT=0.5
UNBOUND_MEM_LIMIT=512M
KEEPALIVED_CPU_LIMIT=0.25
KEEPALIVED_MEM_LIMIT=128M

# Logging
ENABLE_QUERY_LOGGING=true

# DNS settings
ENABLE_DNSSEC=true
DNS_RATE_LIMIT=100
DNS_CACHE_SIZE=256

# =============================================================================
# NOTES
# =============================================================================
#
# Privacy Policy:
#   This stack ONLY uses Unbound (local recursive resolver) for DNS.
#   Public DNS providers (Google, Cloudflare, etc.) are NOT supported.
#   See docs/PIHOLE_CONFIGURATION.md for rationale.
#
# Security:
#   - All *_PASSWORD variables should be generated with: openssl rand -base64 32
#   - Never commit .env files to git
#   - Keep passwords secure and unique
#
# Two-Pi HA Setup:
#   - Most variables should be IDENTICAL on both Pis
#   - Different on each Pi: HOST_IP, NODE_ROLE, KEEPALIVED_PRIORITY, PEER_IP
#   - See env/pi1.env.example and env/pi2.env.example for node-specific values
#
# Documentation:
#   - README.md - Quick start and overview
#   - docs/install-two-pi-ha.md - Detailed two-Pi HA installation
#   - docs/operations.md - Day-to-day operations
#   - TROUBLESHOOTING.md - Common issues and solutions
#
# =============================================================================
