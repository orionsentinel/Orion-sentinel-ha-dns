# Example environment configuration for Multi-Node HA Setup

#####################################
# NODE CONFIGURATION
#####################################
# Set this to identify which node this is
# Options: "primary" or "secondary"
NODE_ROLE=primary

# IP address of THIS node
NODE_IP=192.168.8.11

# IP address of the PEER node
PEER_IP=192.168.8.12

#####################################
# NETWORK CONFIGURATION
#####################################
# Physical network interface (usually eth0)
NETWORK_INTERFACE=eth0

# Network subnet
SUBNET=192.168.8.0/24

# Network gateway
GATEWAY=192.168.8.1

# Virtual IP (VIP) for high availability
# This IP will float between nodes
# NOTE: Must NOT be .0 (network) or .255 (broadcast) address!
VIP_ADDRESS=192.168.8.249

#####################################
# DNS SERVICE IP ADDRESSES
#####################################
# Pi-hole Primary (runs on Node #1)
PRIMARY_DNS_IP=192.168.8.251

# Pi-hole Secondary (runs on Node #2)
SECONDARY_DNS_IP=192.168.8.252

# Unbound Primary (runs on Node #1)
UNBOUND_PRIMARY_IP=192.168.8.253

# Unbound Secondary (runs on Node #2)
UNBOUND_SECONDARY_IP=192.168.8.254

#####################################
# KEEPALIVED CONFIGURATION
#####################################
# Keepalived priority (higher = more likely to be MASTER)
# Primary node: 100
# Secondary node: 90
KEEPALIVED_PRIORITY=100

# Virtual Router ID (must be same on both nodes)
VIRTUAL_ROUTER_ID=51

# VRRP Authentication Password
VRRP_PASSWORD=SecureVRRPPassword123!

# Use unicast VRRP instead of multicast (recommended)
USE_UNICAST_VRRP=true

#####################################
# PI-HOLE DNS UPSTREAM CONFIGURATION
#####################################
#
# ⚠️  CRITICAL PRIVACY WARNING ⚠️
#
# This project ONLY supports the following upstream DNS providers:
#   ✅ Unbound (local recursive resolver) - RECOMMENDED for maximum privacy
#   ✅ NextDNS (via DoT) - Alternative with user-controlled privacy settings
#
# DO NOT USE PUBLIC DNS PROVIDERS - They expose your DNS queries!
#   ❌ Google DNS (8.8.8.8, 8.8.4.4)
#   ❌ Cloudflare DNS (1.1.1.1, 1.0.0.1)
#   ❌ OpenDNS (208.67.222.222, 208.67.220.220)
#   ❌ Quad9 (9.9.9.9, 149.112.112.112)
#   ❌ Any other third-party DNS provider
#
# Pi-hole upstreams point to local Unbound by default (maximum privacy).
# See docs/PIHOLE_CONFIGURATION.md for full privacy rationale.
#
#####################################

# Pi-hole admin password (same on both nodes)
PIHOLE_PASSWORD=ChangeThisSecurePassword123!

# Timezone
TZ=Europe/London

#####################################
# SYNCHRONIZATION SETTINGS
#####################################
# Sync interval in seconds (for Pi-hole config sync)
SYNC_INTERVAL=3600

# Gravity Sync mode: "push" (primary to secondary) or "pull" (secondary from primary)
GRAVITY_SYNC_MODE=push

# Gravity Sync frequency (cron format)
# Default: Every hour
GRAVITY_SYNC_CRON="0 * * * *"

#####################################
# MONITORING & OBSERVABILITY
#####################################
# Deploy monitoring stack? (true/false)
# Only set to true on primary node to save resources
DEPLOY_MONITORING=true

# Grafana admin password
GRAFANA_ADMIN_PASSWORD=ChangeThisGrafanaPassword!

# Prometheus retention period
PROMETHEUS_RETENTION=30d

#####################################
# SIGNAL NOTIFICATIONS (Optional)
#####################################
# Your phone number registered with Signal
SIGNAL_NUMBER=+1234567890

# Recipient phone numbers (comma-separated)
SIGNAL_RECIPIENTS=+1234567890

# Enable notifications for:
NOTIFY_ON_FAILOVER=true
NOTIFY_ON_FAILBACK=true
NOTIFY_ON_SYNC_FAILURE=true
NOTIFY_ON_SERVICE_DOWN=true

#####################################
# AI-WATCHDOG (Optional)
#####################################
# Deploy AI-Watchdog? (only on primary node)
DEPLOY_AI_WATCHDOG=true

# Watchdog check interval in seconds
WATCHDOG_CHECK_INTERVAL=30

# Number of failures before restart
WATCHDOG_RESTART_THRESHOLD=3

# Alert cooldown period in seconds
WATCHDOG_ALERT_COOLDOWN=300

#####################################
# BACKUP CONFIGURATION
#####################################
# Backup retention in days
BACKUP_RETENTION_DAYS=30

# Backup location
BACKUP_PATH=/opt/dns-backups

# Enable automatic backups
AUTO_BACKUP_ENABLED=true

# Backup schedule (cron format) - Daily at 2 AM
BACKUP_CRON="0 2 * * *"

#####################################
# ADVANCED SETTINGS
#####################################
# DNS query logging
ENABLE_QUERY_LOGGING=true

# DNSSEC validation
ENABLE_DNSSEC=true

# DNS-over-HTTPS (DoH) - via Cloudflared
ENABLE_DOH=false

# Rate limiting (queries per second per client)
DNS_RATE_LIMIT=100

# Cache size (MB)
DNS_CACHE_SIZE=256

#####################################
# DOCKER RESOURCE LIMITS
#####################################
# Pi-hole container limits
PIHOLE_CPU_LIMIT=1.0
PIHOLE_MEM_LIMIT=512M

# Unbound container limits
UNBOUND_CPU_LIMIT=0.5
UNBOUND_MEM_LIMIT=256M

# Keepalived container limits
KEEPALIVED_CPU_LIMIT=0.25
KEEPALIVED_MEM_LIMIT=128M

# Automation Configuration
UPDATE_INTERVAL=86400                # Blocklist update interval (24 hours)
BACKUP_INTERVAL=86400                # Backup interval (24 hours)
RETENTION_DAYS=30                    # Backup retention (30 days)
SYNC_INTERVAL=300                    # Config sync interval (5 minutes)
HEALTH_CHECK_INTERVAL=60             # Health check interval (60 seconds)
MAX_RESTART_ATTEMPTS=3               # Max auto-restart attempts
RESTART_COOLDOWN=300                 # Cooldown between restarts (5 minutes)
TEST_DOMAIN=google.com               # Domain for DNS tests
DISK_USAGE_THRESHOLD=85              # Disk cleanup threshold (85%)
MEMORY_USAGE_THRESHOLD=90            # Memory restart threshold (90%)
LOG_MAX_SIZE_MB=100                  # Log rotation threshold (100MB)
BACKUP_DIR=/backup                   # Backup directory
ALERT_WEBHOOK=                       # Optional webhook for alerts

#####################################
# NEXTDNS OVER DOT CONFIGURATION
#####################################
#
# ⚠️  IMPORTANT: NextDNS is the ONLY acceptable alternative to Unbound!
#
# By default, Unbound performs recursive DNS resolution (NEXTDNS_ENABLED=false).
# This is the RECOMMENDED configuration for maximum privacy.
#
# NextDNS is the ONLY approved alternative because:
#   ✅ User-controlled privacy settings (you can disable logging entirely)
#   ✅ Encrypted transport (DNS-over-TLS)
#   ✅ Privacy-focused company with explicit no-data-selling policy
#
# DO NOT substitute NextDNS with other cloud DNS providers!
# Google DNS, Cloudflare, OpenDNS, Quad9, etc. are NOT supported.
#
# To configure NextDNS:
# 1. Create a NextDNS profile at https://my.nextdns.io
# 2. Get your profile-specific IPv4 endpoint
# 3. Set the values below on BOTH nodes
# 4. IMPORTANT: Configure privacy in NextDNS dashboard (disable logging)
#
# See: docs/PIHOLE_CONFIGURATION.md for privacy rationale
#####################################

# Enable NextDNS integration
# Set to false (RECOMMENDED) for maximum privacy with Unbound root recursion
# Set to true ONLY if you need NextDNS filtering and have configured privacy
NEXTDNS_ENABLED=false

# NextDNS IPv4 endpoint (replace with your profile-specific IP)
# NEXTDNS_IPV4=45.90.28.xxx
NEXTDNS_IPV4=45.90.28.0

# NextDNS IPv6 endpoint (optional)
NEXTDNS_IPV6=

# NextDNS DoT port
NEXTDNS_DOT_PORT=853

# NextDNS hostname for TLS verification
NEXTDNS_HOSTNAME=dns.nextdns.io
